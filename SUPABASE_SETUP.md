# Настройка Supabase для "Игры в Кальмара"

## Шаг 1: Создание таблиц в Supabase

1. Перейдите в вашу Supabase Dashboard: https://app.supabase.com
2. Выберите ваш проект (URL: https://fwxmlclskryblitkdgcp.supabase.co)
3. Откройте **SQL Editor** в боковом меню
4. Скопируйте содержимое файла `supabase-schema.sql` и выполните его
5. **ВАЖНО**: Затем выполните файл `supabase-migration-add-login.sql` для добавления поля login

Это создаст следующие таблицы:
- **players** - игроки с уникальными логинами (без регистрации)
- **games** - активные и завершенные игры
- **guesses** - история попыток отгадывания

## Шаг 2: Получение API ключей

1. В Supabase Dashboard откройте **Settings** → **API**
2. Найдите следующие значения:
   - **URL**: уже есть у вас (https://fwxmlclskryblitkdgcp.supabase.co)
   - **anon public**: скопируйте этот ключ

## Шаг 3: Настройка .env файла

1. Откройте файл `.env` в корне проекта
2. Замените `your_anon_key_here` на ваш **anon public** ключ из Supabase:

```env
VITE_SUPABASE_URL=https://fwxmlclskryblitkdgcp.supabase.co
VITE_SUPABASE_ANON_KEY=ваш_ключ_здесь
```

## Шаг 4: Проверка подключения

1. Установите зависимости (если еще не установлены):
```bash
npm install
```

2. Запустите приложение:
```bash
npm run dev
```

3. Откройте приложение в браузере
4. Проверьте, что:
   - Счетчик онлайн игроков работает
   - Вы можете создать игру
   - Другие игроки могут присоединиться к вашей игре

## Функциональность

### Реализованные возможности:

✅ **Пользовательские логины**
- Каждый посетитель выбирает свой уникальный логин (3-20 символов)
- Проверка доступности логина в реальном времени
- Логин может содержать буквы, цифры, _ и -
- Аватары: ○, △, □ (выбор пользователя)
- Автоматическое отслеживание онлайн статуса

✅ **Счетчик онлайн игроков**
- Показывает количество активных пользователей
- Обновляется в реальном времени

✅ **Создание игры**
- Выбор режима: ЦИФРЫ (4 цифры) или СЛОВА (5 букв)
- Опциональный приз (отображается в игре и в победе)
- Игра появляется в лобби для других игроков

✅ **Присоединение к игре**
- Просмотр активных игр в лобби
- Информация о создателе, режиме и призе
- Кнопка "ВСТУПИТЬ В ИГРУ"

✅ **Логика отгадывания**
- Проверка позиций: совпадают только символы на правильных позициях
- Пример: загадано 4567, попытка 2369 → совпадает только 6 (на 3-й позиции)
- Постепенное раскрытие совпавших символов

✅ **Чат истории**
- Оптимизирован: находится справа во фрейме (не занимает весь экран)
- Показывает все попытки отгадывания обоих игроков
- Результат каждой попытки (ВЕРНО!, ОТКРЫТО: N, НЕТ СОВПАДЕНИЙ)

✅ **Система призов**
- Создатель указывает приз при создании игры
- Приз отображается в карточке игры в лобби
- При победе показывается экран с призом

✅ **Real-time обновления**
- Автоматическая синхронизация состояния игры между игроками
- Подписка на изменения через Supabase Realtime
- Обновление онлайн игроков и списка игр

## Структура базы данных

### Таблица `players`
- `id` - UUID игрока
- `login` - уникальный логин пользователя (3-20 символов)
- `nickname` - отображаемое имя (равно login)
- `avatar` - один из символов: ○, △, □
- `is_online` - статус онлайн
- `last_seen` - последняя активность

### Таблица `games`
- `id` - UUID игры
- `creator_id` - создатель игры
- `opponent_id` - оппонент
- `game_mode` - NUMBERS или WORDS
- `status` - WAITING, SETUP, PLAYING, FINISHED
- `prize` - приз (опционально)
- `creator_secret` / `opponent_secret` - загаданные значения
- `creator_revealed_indices` / `opponent_revealed_indices` - открытые позиции
- `current_turn` - чей сейчас ход
- `winner_id` - победитель

### Таблица `guesses`
- `id` - UUID попытки
- `game_id` - связь с игрой
- `player_id` - кто делал попытку
- `guess` - значение попытки
- `result` - результат ("ВЕРНО!", "ОТКРЫТО: 2", и т.д.)
- `matches_count` - количество совпадений

## Безопасность

Row Level Security (RLS) включен для всех таблиц с базовыми политиками доступа.
Для production версии рекомендуется настроить более строгие политики безопасности.

## Поддержка

При возникновении проблем:
1. Проверьте консоль браузера на наличие ошибок
2. Убедитесь, что SQL скрипт выполнен полностью
3. Проверьте правильность API ключей в .env файле
4. Убедитесь, что Realtime включен в настройках Supabase
